#ifndef _KORALI_SOLVER_MOCMAES_HPP_
#define _KORALI_SOLVER_MOCMAES_HPP_

#include "modules/distribution/univariate/normal/normal.hpp"
#include "modules/distribution/univariate/uniform/uniform.hpp"
#include "modules/solver/optimizer/optimizer.hpp"
#include <vector>

namespace korali
{
namespace solver
{
namespace optimizer
{
class MOCMAES : public Optimizer
{
  public:
  /**
  * @brief Prepares generation for the next set of evaluations
 */
  void prepareGeneration();

  /**
  * @brief Evaluates a single sample
  * @param sampleIdx Index of the sample to evaluate
 */
  void sampleSingle(size_t sampleIdx);

  /**
   * @brief Adapts the covariance matrix.
   * @param hsig Sign
  */
  void adaptC(int hsig);

  /**
    * @brief Updates scaling factor of covariance matrix.
 */
  void updateSigma(); /* update Sigma */

  /**
 * @brief Updates mean and covariance of Gaussian proposal distribution.
 * @param evaluations Model evaluations for proposed samples
 */
  void updateDistribution(const std::vector<double> &evaluations);

  /**
  * @brief Descending sort of vector elements, stores ordering in _sortingIndex.
  * @param _sortingIndex Ordering of elements in vector
  * @param vec Vector to sort
  * @param N Number of current samples.
 */
  void sort_index(const std::vector<double> &vec, std::vector<size_t> &_sortingIndex, size_t N) const;

  /**
 * @brief Configures CMA-ES.
 */
  void setInitialConfiguration() override;

  /**
 * @brief Executes sampling & evaluation generation.
 */
  void runGeneration() override;

  /**
 * @brief Console Output before generation runs.
 */
  void printGenerationBefore() override;

  /**
 * @brief Console output after generation.
 */
  void printGenerationAfter() override;

  /**
 * @brief Final console output at termination.
 */
  void finalize() override;
};

} // namespace optimizer
} // namespace solver
} // namespace korali

#endif // _KORALI_SOLVER_MOCMAES_HPP_
